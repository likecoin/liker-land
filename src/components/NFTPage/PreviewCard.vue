<template>
  <CardV2
    :class="[
      'flex',
      'flex-col',

      'overflow-hidden',

      'border-[1px]',
      'border-shade-gray',
    ]"
    :has-padding="false"
  >
    <div
      v-if="imageUrl"
      class="h-[180px]"
      :style="`background-color: ${imageBgColor}`"
    >
      <img
        class="object-cover w-full max-h-[180px]"
        :src="resizedImageSrc"
      >
    </div>
    <div
      v-else
      class="h-[180px]"
    >
      <img
        class="object-cover h-full max-h-[180px]"
        src="~/assets/images/nft/primitive-nft.png"
      >
    </div>
    <div
      :class="[
        'flex',
        'flex-col',
        'justify-center',
        'items-center',
        'whitespace-pre-line',
        'break-all',
        'px-[24px]',
        'pt-[48px]',
        'py-[24px]',
        'relative',
      ]"
    >
      <div class="flex flex-col items-center justify-center mt-[-70px]">
        <Identity
          :avatar-url="avatarUrl"
          :avatar-size="avatarSize"
          :is-avatar-outlined="isAvatarOutlined"
        />
        <NuxtLink
          class="flex mt-[8px]"
          :to="`/${iscnOwner}`"
        >
          <Label class="text-medium-gray" text="by" />
          <Label class="text-like-green ml-[4px] font-600">{{
            displayName | ellipsis
          }}</Label>
        </NuxtLink>
      </div>
      <Label
        class="mt-[12px]"
        content-class="line-clamp-2"
        preset="h5"
        align="center"
        :text="nftName"
      />
      <Label
        class="mt-[12px]"
        content-class="line-clamp-4"
        preset="p5"
        :text="nftDescription | ellipsisDescription"
      />
      <template v-if="url">
        <Separator class="my-[16px]" />
        <ButtonV2
          preset="outline"
          :text="$t('campaign_nft_item_view_details_label')"
          :href="url"
          target="_blank"
          @click="handleClickViewContent"
        >
          <template #prepend>
            <IconArticle />
          </template>
          <template #append>
            <IconLinkExternal />
          </template>
        </ButtonV2>
      </template>
      <div class="grid grid-flow-col gap-[16px] items-center justify-center mt-[18px] text-[12px]">
        <div class="flex items-center text-medium-gray">
          <IconMint />
          <div class="ml-[4px]">{{ collectedCount }}</div>
        </div>
        <div class="flex items-center text-medium-gray">
          <IconOwner />
          <div class="ml-[4px]">{{ collectorCount }}</div>
        </div>
        <div class="flex items-center text-like-green">
          <IconPrice />
          <div class="ml-[4px]">{{ nftPrice | formatNumberWithLIKE }}</div>
        </div>
      </div>
    </div>
  </CardV2>
</template>

<script>
import {
  ellipsis,
  ellipsisDescription,
  formatNumberWithLIKE,
  getLikeCoResizedImageUrl,
} from '~/util/ui';

export default {
  name: 'ItemCard',
  filters: {
    ellipsis,
    ellipsisDescription,
    formatNumberWithLIKE,
  },
  props: {
    url: {
      type: String,
      default: undefined,
    },

    // BackgroundImg
    imageBgColor: {
      type: String,
      default: undefined,
    },
    imageUrl: {
      type: String,
      default: undefined,
    },

    // Identity
    avatarUrl: {
      type: String,
      default: undefined,
    },
    avatarSize: {
      type: Number,
      default: 40,
    },
    isAvatarOutlined: {
      type: Boolean,
      default: false,
    },

    // Creater Info
    iscnOwner: {
      type: String,
      default: undefined,
    },
    displayName: {
      type: String,
      default: undefined,
    },

    // NFT Info
    nftName: {
      type: String,
      default: undefined,
    },
    nftDescription: {
      type: String,
      default: undefined,
    },
    nftPrice: {
      type: Number,
      default: undefined,
    },

    // Mint Info
    collectedCount: {
      type: Number,
      default: 0,
    },
    collectorCount: {
      type: Number,
      default: 0,
    },
  },
  computed: {
    formattedNFTPrice() {
      return `${this.nftPrice || '-'} LIKE`;
    },
    imageSize() {
      return 720;
    },
    resizedImageSrc() {
      return getLikeCoResizedImageUrl(this.imageUrl, this.imageSize);
    },
  },
  methods: {
    handleClickCollect() {
      this.$emit('collect');
    },
    handleClickViewContent() {
      this.$emit('view-content');
    },
  },
};
</script>
